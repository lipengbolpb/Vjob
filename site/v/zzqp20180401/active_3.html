<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no" />
    <title>青岛啤酒华中</title>
    <script src="js/rem.js"></script>
    <link rel="stylesheet" href="css/active_3.css?v=1.9">
</head>

<body>
    <div class="wrap">
        <div class="header">
            <img src="img/guess/light-1.png" class="light-1">
            <img src="img/guess/light-2.png" class="light-2">
            <img src="img/guess/light-3.png" class="light-3">
            <img src="img/guess/light-4.png" class="light-4">
            <img src="img/guess/slogan-4.png" class="slogan">
        </div>
        <p class="notice">活动规则及说明</p>
        <div class="select">
            <div class="slides">
                <input type="button" class="slide1 slide active" value="第一环节">
                <input type="button" class="slide2 slide" value="第二环节">
                <input type="button" class="slide3 slide" value="第三环节">
            </div>
            <div class="content">
                <div key="2" item="214" class="icon">
                    <img src="img/guess/E-1.png">
                    <p>俄罗斯</p>
                </div>
                <div key="2" item="203" class="icon">
                    <img src="img/guess/E-2.png">
                    <p>比利时</p>
                </div>
                <div key="2" item="204" class="icon">
                    <img src="img/guess/E-3.png">
                    <p>英格兰</p>
                </div>
                <div key="2" item="208" class="icon">
                    <img src="img/guess/E-4.png">
                    <p>法国</p>
                </div>
                <div key="2" item="202" class="icon">
                    <img src="img/guess/E-5.png">
                    <p>西班牙</p>
                </div>
                <div key="2" item="205" class="icon">
                    <img src="img/guess/E-6.png">
                    <p>波兰</p>
                </div>
                <div key="2" item="206" class="icon">
                    <img src="img/guess/E-7.png">
                    <p>冰岛</p>
                </div>
                <div key="2" item="209" class="icon">
                    <img src="img/guess/E-8.png">
                    <p>葡萄牙</p>
                </div>
                <div key="2" item="201" class="icon">
                    <img src="img/guess/E-9.png">
                    <p>德国</p>
                </div>
                <div key="2" item="213" class="icon">
                    <img src="img/guess/E-10.png">
                    <p>丹麦</p>
                </div>
                <div key="2" item="211" class="icon">
                    <img src="img/guess/E-11.png">
                    <p>瑞典</p>
                </div>
                <div key="2" item="212" class="icon">
                    <img src="img/guess/E-12.png">
                    <p>克罗地亚</p>
                </div>
                <div key="2" item="210" class="icon">
                    <img src="img/guess/E-13.png">
                    <p>瑞士</p>
                </div>
                <div key="2" item="207" class="icon">
                    <img src="img/guess/E-14.png">
                    <p>塞尔维亚</p>
                </div>
                <div key="4" item="401" class="icon">
                    <img src="img/guess/S-1.png">
                    <p>巴西</p>
                </div>
                <div key="4" item="402" class="icon">
                    <img src="img/guess/S-2.png">
                    <p>乌拉圭</p>
                </div>
                <div key="4" item="403" class="icon">
                    <img src="img/guess/S-3.png">
                    <p>阿根廷</p>
                </div>
                <div key="4" item="404" class="icon">
                    <img src="img/guess/S-4.png">
                    <p>哥伦比亚</p>
                </div>
                <div key="4" item="405" class="icon">
                    <img src="img/guess/S-5.png">
                    <p>秘鲁</p>
                </div>
                <div key="1" item="101" class="icon">
                    <img src="img/guess/A-1.png">
                    <p>伊朗</p>
                </div>
                <div key="1" item="102" class="icon">
                    <img src="img/guess/A-2.png">
                    <p>日本</p>
                </div>
                <div key="1" item="103" class="icon">
                    <img src="img/guess/A-3.png">
                    <p>韩国</p>
                </div>
                <div key="1" item="104" class="icon">
                    <img src="img/guess/A-4.png">
                    <p>沙特阿拉伯</p>
                </div>
                <div key="1" item="105" class="icon">
                    <img src="img/guess/A-5.png">
                    <p>澳大利亚</p>
                </div>
                <div key="3" item="302" class="icon">
                    <img src="img/guess/F-1.png">
                    <p>尼日利亚</p>
                </div>
                <div key="3" item="301" class="icon">
                    <img src="img/guess/F-2.png">
                    <p>埃及</p>
                </div>
                <div key="3" item="304" class="icon">
                    <img src="img/guess/F-3.png">
                    <p>塞内加尔</p>
                </div>
                <div key="3" item="305" class="icon">
                    <img src="img/guess/F-4.png">
                    <p>摩洛哥</p>
                </div>
                <div key="3" item="303" class="icon">
                    <img src="img/guess/F-5.png">
                    <p>突尼斯</p>
                </div>
                <div key="5" item="501" class="icon">
                    <img src="img/guess/N-1.png">
                    <p>墨西哥</p>
                </div>
                <div key="5" item="502" class="icon">
                    <img src="img/guess/N-2.png">
                    <p>哥斯达黎加</p>
                </div>
                <div key="5" item="503" class="icon">
                    <img src="img/guess/N-3.png">
                    <p>巴拿马</p>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-1.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-2.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-3.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-4.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-5.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list">
                    <div class="num">
                        <img src="img/guess/cc-6.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="list" style="border-bottom: none;">
                    <div class="num">
                        <img src="img/guess/cc-7.png">
                    </div>
                    <div class="win">
                        <span>胜</span>
                    </div>
                    <div class="tie">
                        <span>平</span>
                    </div>
                    <div class="lose">
                        <span>负</span>
                    </div>
                </div>
                <div class="result">
                    <img src="img/guess/title.png" class="title">
                    <div class="resultContent">
                        <div class="point">
                            <div class="left" id="love">
                                <img src="img/guess/0.png">
                                <p style="font-size:0.55rem;height:0.55rem;color: #fdd925;"></p>
                            </div>
                            <img src="img/guess/point.png" class="middlePoint">
                            <div class="right" id="match">
                                <img src="img/guess/0.png">
                                <p style="font-size:0.55rem;height:0.55rem;color: #fdd925;">总决赛对手</p>
                            </div>
                        </div>
                    </div>
                    <input type="button" value="确认提交" id="tj">
                </div>
                <div class="selected">
                    <p>您所支持的球队</p>
                    <img src="" class="jack">
                    <p class="love"></p>
                </div>
            </div>
            <p class="explain">90分钟以内（算伤停补时）</p>
        </div>
        <div class="input">
            <img src="img/guess/football.png">
            <div class="alert">
                <!-- <input type="text" id="cai"> -->
                <input type="text" id="cai" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') "
                    value="" maxlength="2" />
                <div class="inputBtns">
                    <input type="button" value="取消" class="no">
                    <input type="button" value="确定" class="yes">
                </div>
            </div>
        </div>
        <div class="rule">
            <img src="img/guess/active3.png?v=1">
            <img src="img/guess/close.png" class="close">
        </div>
        <div class="mask">
            <img src="img/guess/football.png">
            <div class="alert">
                <p>您确认支持<span id="choose"></span>成为冠军球队吗？
                    <br>选择仅此一次，后续无法更改，三思哦~</p>
                <div class="btns">
                    <input type="button" value="取消" class="cancel">
                    <input type="button" value="确定" class="confirm">
                </div>
            </div>
        </div>
    </div>
</body>
<script src="js/jquery-2.2.4.min.js"></script>
<script src="/static/js/vve/10core.js"></script>
<script src="/static/js/vve/11tool.js"></script>
<script src="/static/js/vve/12event.js"></script>
<script src="/static/js/vve/20ajx.js"></script>
<script src="/static/js/vve/21tpl.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/v/js/cfg.js?v=1.0.0"></script>
<script src="/v/js/publictip.js?v=3.0.1"></script>
<script src="/static/js/wx/jsdk.js?v=3"></script>
<script src="/static/js/font.js"></script>
<script>
    ini_wxshare(vge.zzqpappid);
    // 隐藏微信右上角菜单
    wx.ready(function () {
        wx.hideOptionMenu();
    });
</script>
<script>
    var openid = sessionStorage.openid;
    $(document).ready(function () {
        var team = '', //支持球队
            winOrlose = ['', '', '', '', '', '', ''], //胜负平
            points_1 = '0', //支持球队分数
            points_2 = '0', //对手分数
            hand = false; //是否参与过，false未参与，true参与过
        loading();
        getUserInfo();


        function init(jo, flag) {
            $('.icon').css('display', 'block');
            for (var i = 0; i < $('.slide').length; i++) {
                (function (i) {
                    $('.slide').eq(i).on('click', function () {
                        $('.slide').removeClass('active');
                        $(this).addClass('active');
                        switch (i) {
                            case 0:
                                $('.icon').css('display', 'block');
                                $('.list').css('display', 'none');
                                $('.result').css('display', 'none');
                                $('.explain').css('display', 'none');
                                if (hand || team != '') {
                                    var H = document.getElementsByClassName('content')[0].scrollHeight;
                                    $('.selected').css('height', H + 'px');
                                    $('.selected').css('display', 'block');
                                    $('.icon').addClass('noPointer');
                                } else {
                                    $('.selected').css('display', 'none');
                                }
                                break;
                            case 1:
                                $('.icon').css('display', 'none');
                                $('.list').css('display', 'block');
                                $('.explain').css('display', 'block');
                                $('.result').css('display', 'none');
                                $('.selected').css('display', 'none');
                                break;
                            case 2:
                                $('.icon').css('display', 'none');
                                $('.list').css('display', 'none');
                                $('.explain').css('display', 'none');
                                $('.result').css('display', 'block');
                                $('.selected').css('display', 'none');
                                break;
                        }
                    });
                })(i);
            }
            if (flag) { //参与过
                hand = true;
                //支持球队
                // $('[item=' + jo.supportTeam + ']').addClass('gray');
                // for (var i = 0; i < $('.icon').length; i++) {
                //     (function (i) {
                //         $('.icon').eq(i).on('click', function () {
                //             title_tip('尊敬的用户', '你都选了' + $('[item=' + jo.supportTeam + ']').find('p')
                //                 .html() +
                //                 '了,别再点了', '我知道了');
                //         });
                //     })(i);
                // }

                $('.icon').unbind();
                $('.icon').addClass('noPointer');
                $('.jack').attr('src', $('[item=' + jo.supportTeam + ']').find('img').attr('src'));
                $('.love').text($('[item=' + jo.supportTeam + ']').find('p').html());
                // var H = $('.content').css('height');
                // $('.selected').css('height','H');
                var H = document.getElementsByClassName('content')[0].scrollHeight;
                console.log('H:' + H);
                $('.selected').css('height', H + 'px');
                $('.selected').css('display', 'block');
                //胜负平
                var teamRecord = jo.teamRecord.split(':');
                console.log(teamRecord);
                console.log($('.list').eq(0).children().eq(1).find('span'));
                for (var i = 0; i < teamRecord.length; i++) {
                    if (teamRecord[i] == '0') {
                        $('.list').eq(i).children().eq(1).find('span').addClass('round');
                    } else if (teamRecord[i] == '2') {
                        $('.list').eq(i).children().eq(2).find('span').addClass('round');
                    } else if (teamRecord[i] == '1') {
                        $('.list').eq(i).children().eq(3).find('span').addClass('round');
                    }
                }
                //猜比分(取冒号以前和冒号以后数值)
                var pointRecord = jo.teamLast.split('');
                var prev = '',
                    next = '';
                var _index = jo.teamLast.indexOf(':');
                var arrPrev = pointRecord.slice(0, _index);
                var arrNext = pointRecord.slice(_index + 1, pointRecord.length);
                prev = arrPrev.join('');
                next = arrNext.join('');
                console.log('prev:' + prev);
                console.log('next:' + next);
                $('#love').find('img').attr('src', 'img/guess/' + prev + '.png');
                $('#match').find('img').attr('src', 'img/guess/' + next + '.png');
                $('#love').find('p').text($('[item=' + jo.supportTeam + ']').find('p').html());
            } else { //未参与过
                hand = false;
                //支持球队
                for (var i = 0; i < $('.icon').length; i++) {
                    (function (i) {
                        $('.icon').eq(i).on('click', function () {
                            // var $that = $(this);
                            $('#choose').text('"' + $('.icon').eq(i).find('p').html() + '"');
                            $('.mask').css('display', 'block');
                            // team = $('.list').eq(i).attr('item');
                            $('.confirm').on('click', function () { //确定
                                // team = $that.attr('item');
                                team = $('.icon').eq(i).attr('item');
                                $('.mask').css('display', 'none');
                                // //跳转到第二环节
                                $('.icon').css('display', 'none');
                                $('.list').css('display', 'block');
                                $('.result').css('display', 'none');
                                $('.explain').css('display', 'block');
                                $('.slide').removeClass('active');
                                $('.slide').eq(1).addClass('active');
                                //第一环节不可修改
                                $('.jack').attr('src', $('[item=' + team + ']').find(
                                    'img').attr('src'));
                                $('.love').text($('[item=' + team + ']').find('p')
                                    .html());
                                $('.selected').css('display', 'none');
                                $('#love').find('p').text($('[item=' + team + ']').find('p')
                                    .html());
                                console.log(team);
                            });
                        });
                    })(i);
                }
                //胜负平
                for (var i = 0; i < $('.list').length; i++) {
                    (function (i) {
                        var l = $('.list').eq(i).children().length;
                        for (var j = 1; j < l; j++) {
                            (function (j) {
                                $('.list').eq(i).children().eq(j).on('click', function () {
                                    $(this).parent().children().find('span').removeClass(
                                        'round');
                                    $(this).find('span').addClass('round');
                                    if (j == 1) {
                                        winOrlose[i] = '0';
                                    } else if (j == 2) {
                                        winOrlose[i] = '2';
                                    } else {
                                        winOrlose[i] = '1';
                                    }
                                    if (ifnull(winOrlose)) {
                                        //跳转第三环节
                                        $('.icon').css('display', 'none');
                                        $('.list').css('display', 'none');
                                        $('.result').css('display', 'block');
                                        $('.explain').css('display', 'none');
                                        $('.slide').removeClass('active');
                                        $('.slide').eq(2).addClass('active');
                                    }
                                });
                            })(j);
                        }
                    })(i);
                }
                //猜比分
                $('#cai').on('keyup', function () {
                    if (Number($('#cai').val()) >= 20) {
                        $('#cai').val(20);
                    }
                });
                $('#love').on('click', function () {
                    $('.input').css('display', 'block');
                    $('.yes').on('click', function () {
                        //校验不为空
                        if ($('#cai').val() == '') {
                            title_tip('尊敬的用户', '不能为空', '我知道了');
                        } else {
                            points_1 = $('#cai').val();
                            $('.yes').unbind();
                            $('.input').css('display', 'none');
                            $('#cai').val('');
                            $('#love').find('img').attr('src', 'img/guess/' + points_1 + '.png');
                            console.log(points_1);
                        }
                    });
                });
                $('#match').on('click', function () {
                    $('.input').css('display', 'block');
                    $('.yes').on('click', function () {
                        //校验不为空
                        if ($('#cai').val() == '') {
                            title_tip('尊敬的用户', '不能为空', '我知道了');
                        } else {
                            points_2 = $('#cai').val();
                            $('.yes').unbind();
                            $('.input').css('display', 'none');
                            $('#cai').val('');
                            $('#match').find('img').attr('src', 'img/guess/' + points_2 +
                                '.png');
                            console.log(points_2);
                        }
                    });
                });
            }
        }

        function getUserInfo() { //获取用户参与信息
            var data = {
                "openid": openid,
                "transType": '3'
            };
            $.ajax({
                type: "POST",
                url: vge.zzqp + '/DBTHNQPInterface/vpointsGuess/footballStatus',
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (res, status, xhr) {
                    console.log(res);
                    loaded();
                    if (res.result.code == '0') {
                        if (res.result.businessCode == '0') { //用户参与过
                            init(res.reply, true);
                        } else if (res.result.businessCode == '000003') { //未参与过
                            init(res.reply, false);
                        } else {
                            title_tip('尊敬的用户', '呜呜，系统开了个小差，请稍后重试！', '我知道了');
                        }
                    } else { //code!='0'
                        title_tip('尊敬的用户', res.result.msg, '我知道了');
                    }
                },
                error: function (res, status, xhr) {
                    loaded();
                    title_tip('尊敬的用户', '呜呜，系统开了个小差，请稍后重试！', '我知道了');
                    console.log(res);
                }
            });
        }

        function setSelect(supportTeam, teamRecord, teamLast) { //最终提交
            loading();
            var data = {
                "openid": openid,
                "transType": '3',
                "supportTeam": supportTeam, //支持球队
                "teamRecord": teamRecord, //球队战绩
                "teamLast": teamLast //决赛成绩
            };
            $.ajax({
                type: "POST",
                url: vge.zzqp + '/DBTHNQPInterface/vpointsGuess/footballGuess',
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (res, status, xhr) {
                    console.log(res);
                    loaded();
                    if (res.result.code == '0') {
                        if (res.result.businessCode == '0') { //竞猜成功
                            title_tip('尊敬的用户', '竞猜成功', '我知道了', '', load);
                        } else {
                            title_tip('尊敬的用户', res.result.msg, '我知道了');
                        }
                    } else {
                        title_tip('尊敬的用户', res.result.msg, '我知道了');
                    }
                },
                error: function (res, status, xhr) {
                    loaded();
                    title_tip('尊敬的用户', '呜呜，系统开了个小差，请稍后重试！', '我知道了');
                    console.log(res);
                }
            });
        }

        function loaded() {
            $('.loading').css('display', 'none');
        }

        function loading() {
            $('.loading').css('display', 'block');
        }

        function load() {
            window.location.reload();
        }

        function ifnull(arr) {
            var bool = true;
            for (var k = 0; k < arr.length; k++) {
                if (arr[k] == '') {
                    bool = false;
                }
            }
            return bool;
        }

        function tj(flag) {
            if (flag) {
                var supportTeam = team;
                var teamRecord = winOrlose.join(":");;
                var teamLast = points_1 + ':' + points_2;
                setSelect(supportTeam, teamRecord, teamLast);
            }
        }

        $('.no').on('click', function () {
            $('.input').css('display', 'none');
            $('#cai').val('');
        });
        $('.cancel').on('click', function () { //取消
            $('.mask').css('display', 'none');
            team = '';
        });
        $('.notice').on('click', function () {
            $('.rule').css('display', 'block');
        });
        $('.close').on('click', function () {
            $('.rule').css('display', 'none');
        });
        $('#tj').on('click', function () {
            if (hand) { //如果参与过
                title_tip('尊敬的用户', '每人只能参与一次', '我知道了');
                return;
            }
            //提交之前先校验
            if (team == '') { //没填写支持球队
                title_tip('尊敬的用户', '请在第一环节选择您支持的球队', '我知道了');
                return;
            }
            if (points_1 == '') { //没填写支持球队得分
                title_tip('尊敬的用户', '请填写您支持球队的得分', '我知道了');
                return;
            }
            if (points_2 == '') { //没填写对手得分
                title_tip('尊敬的用户', '请填写对手得分', '我知道了');
                return;
            }
            if (!ifnull(winOrlose)) { //没选择胜负平
                title_tip('尊敬的用户', '请在第二环节选择您支持球队的胜负平', '我知道了');
                return;
            }
            if (points_1 != '' && points_2 != '' && team != '' && ifnull(winOrlose)) {
                // title_tip('尊敬的用户', '本次活动将消耗30积分', '我知道了', '', tj);
                chose_tip('尊敬的用户', '本次活动将消耗30积分', '取消', '', '我知道了', '', tj);
            }
        });
    });
</script>

</html>